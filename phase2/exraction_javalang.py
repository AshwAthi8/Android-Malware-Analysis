import os 
import sys  
import csv 
import javalang

source = "./testmal"
unzipedfiles = "./unzipedfiles" 
movfolder = "./dexfiles"
javafiles = "./javafile"

cs = open('test.csv',"w") 
p=[]
for file in os.listdir(source):
	print("==========",file,"============")
	file1 = os.path.join(source,file) 
	os.system("unzip {} -d unzipedfiles ; ".format(file1))
	i=0
	for f in os.listdir(unzipedfiles):
		if(f.endswith(".dex")):
			i=i+1
			file2 = os.path.join(unzipedfiles,f)
			print(file)
			name=str(file)[:-4]+str(i)
			os.system(" sh ./dex2jar-2.0/d2j-dex2jar.sh -f  {} -o ./dexfiles/{}.jar ".format(file2,name))
	os.system("rm -rf unzipedfiles/* ; ")

for file in os.listdir(movfolder):
	if(file.endswith(".jar")):
		file2 = os.path.join(movfolder,file)
		name=str(file)[:-4]
		os.system("java -jar procyon-decompiler-0.5.36.jar {} > ./javafile/{}.java".format(file2,name))


for file in os.listdir(javafiles):
	file3 = os.path.join(javafiles,file)
	fp = open(file3,'r')
	Lines = fp.readlines()
	tokens = []
	for line in Lines:
		#tokens.append(list(javalang.tokenizer.tokenize(line)))
		#print(tokens)
		print(list(javalang.tokenizer.tokenize(line)))





	#filed = os.path.join(current,file[:-4])
	#file2 = os.path.join(filed,"classes.dex")
	#name = str(file)[:len(str(file))-4]
	#print("#"*10,str(str(file)[:len(str(file))-4]))
	#file3 = os.path.join(file1,name)
	#os.system("mv {} {} ; cp {} ./dexfiles ".format(file2,name,name)) 
	#os.system("rm -rf {}".format(str(file)[:len(str(file))-3]))```