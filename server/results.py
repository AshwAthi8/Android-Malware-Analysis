import requests
import preprocessing
import model
import os
import virustotal_worker
"""
We store all the data into this class so as to 
easily render it later on
"""
class Results(object):
    def __init__(self, name):
        self.name = name
        self.error = False 
        self.message = None
        self.prediciton = 0

"""
This function takes a file name
and returns a Result object after processing
"""
def get_results(filename):
    # Run the module and get the results here
    upload_folder="/home/cloud28@cyberdome.org.in/server/server-files"
    filename=os.path.join(upload_folder,filename)
    result = Results(filename)
    permission, message = preprocessing.getPermmissions(filename)
    
    if not permission:
        result.error = True
        result.message = message
        return result
    result.message = message
    try:
        one_hot_encode = preprocessing.onehot_encode(permission)
    except Exception as e:
        result.error = True
        result.message = "Unable to encode the APK permissions"
        return result
    try:
        result.prediciton = model.predict(one_hot_encode)
    except Exception as e:
        result.error = True
        result.message = "Unable to predict the result"
        return result
    return result