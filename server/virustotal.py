import requests
import json
import os


API_KEY = '' # TODO DO NOT PUSH THIS TO GITHUB REMOVE THIS PART BEFORE COMMITING ANY CODE
upload_folder="/home/cloud28@cyberdome.org.in/server/server-files"

def virus_total_upload(filepath):
    url = 'https://www.virustotal.com/vtapi/v2/file/scan'
    params = {'apikey': API_KEY}
    filename= os.path.join(upload_folder,filepath)
    files = {'file': (filepath, open(filename, 'rb'))}
    response = requests.post(url, files=files, params=params)
    resource = response.json()
    return resource['resource']

def virus_total_get_result(resource):
    url = 'https://www.virustotal.com/vtapi/v2/file/report'
    params = {'apikey': API_KEY, 'resource': resource}   
    response = requests.get(url, params=params)
    # data = json.dumps(response.json(), sort_keys=False, indent=4)
    data = response.json()
    results = {}
    for k in data['scans']:
        results[k] = data['scans'][k]['detected']
    
    return results
